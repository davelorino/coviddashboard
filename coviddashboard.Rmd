---
title: "Saatchi & Saatchi"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: no
    theme: "darkly"
    toc_depth: 3
---




```{css, echo=FALSE}
body .main-container {
  max-width: 1800px !important;
  width: 1800px !important;
}
body {
  max-width: 1800px !important;
}
```

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8,
                      echo=FALSE, warning=FALSE, message=FALSE)
```

```{r include=FALSE}

library(tidyverse)
library(plotly)
library(lubridate)

```

# COVID-19 Insights 

## Key Dates

The Saatchi & Saatchi COVID-19 dashboard examines the timeline of the COVID-19 outbreak from the first identified case of the virus, to now. 

*	Dec 31: First coronavirus case in Wuhan, China
*	Jan 13: First case outside of China (Thailand)
*	Jan 25: First “imported” case reported in Australia 
*	Mar 1-2: First community cases reported in AU (29 total cases) 
*	Mar 21: AU reaches 1,000 cases
*	Mar 19-22: AU govt closes borders to non-residents and non-citizens, and announced mandatory closures of non-essential businesses

#### By Saatchi & Saatchi

## VoC

In this section we examine the drivers of volume and sentiment of conversation among individuals, making careful provition to exclude the voice of business, institutions and organisations to really get a sense of sentiment at a consumer level. 

###	Volume + Drivers

```{r}

volumeovertime <- read_csv("~/Downloads/coronaconvo.csv")


meltwater_week <- function(arg){
    arg %>%
      mutate(Date_Fix = as.Date(`Date`, "%d/%m/%Y")) %>%
      mutate(`Week Beginning` = floor_date(Date_Fix, "weeks")) %>%
      filter(!is.na(`Week Beginning`))
}

summarise_meltwater_by_week <- function(arg){
      arg %>%
      group_by(`Week Beginning`) %>%
      summarise(All = sum(`Total Mentions`), Twitter = sum(Twitter), Forums = sum(Forums), Blogs = sum(Blogs)) %>%
      arrange(`Week Beginning`)
}

corona_weeks <- volumeovertime %>%
  meltwater_week() %>%
  summarise_meltwater_by_week() %>%
  mutate(image_url = "https://miro.medium.com/max/1886/1*YyYozjqwmLA061Khv99k3Q.jpeg")

```

```{r echo=FALSE}
total_mentions_colour <- "#FFFFFF"
twitter_colour <- "#1da1f2"
legend_features <- list(
  font = list(
    size = 12,
    color = "#FFFFFF"),
  bgcolor = "#212121",
  bordercolor = "#FFFFFF",
  borderwidth = 1,
  x = 0.1, 
  y = 0.9)


plotly::plot_ly(data = corona_weeks, 
                customdata = ~ image_url) %>%
  plotly::add_trace(
    x = ~`Week Beginning`,
    # y = ~active_cum,
    y = ~`All`,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Total Mentions",
    line = list(color = total_mentions_colour),
    marker = list(color = total_mentions_colour)
  ) %>%
  plotly::add_trace(
    x = ~`Week Beginning`,
    y = ~Twitter,
    type = "scatter",
    mode = "lines+markers",
    name = "Twitter",
    line = list(color = twitter_colour),
    marker = list(color = twitter_colour)
  ) %>%
  plotly::add_annotations(
    x = as.Date("2019-12-29"),
    y = 1,
    text = paste("First case"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    font = list(color = '#FFFFFF'),
    ax = -90,
    ay = -90
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-01-12"),
    y = 2,
    text = paste("First Case Outside of China (Thailand)"),
    xref = "x",
    yref = "y",
    arrowhead = 10,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    font = list(color = '#FFFFFF'),
    ax = -120,
    ay = -120
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-01-26"),
    y = 3,
    text = paste("First 'Imported' Case in Australia"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    font = list(color = '#FFFFFF'),
    ax = -150,
    ay = -180
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-03-15"),
    y = 3,
    text = paste(
      "New containment",
      "",
      "measures"
    ),
    xref = "x",
    yref = "y",
    arrowhead = 10,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    font = list(color = '#FFFFFF'),
    ax = -10,
    ay = -90
  ) %>%
  plotly::layout(
    title = "",
    yaxis = list(title = "Conversation Over Time", color = "#ffffff"),
    xaxis = list(title = "Week Beginning", color = "#ffffff"),
    legend = legend_features,
    paper_bgcolor='#212121',
    plot_bgcolor='#212121'
  ) %>%
  htmlwidgets::onRender("
function(el, x) {
// when hovering over an element, do something
el.on('plotly_hover', function(d) {
// extract tooltip text
txt = d.points[0].data.x;
console.log(txt);
// image is stored locally
image_location = txt + '.jpg';
// define image to be shown
var img = {
// location of image
source: image_location,
// top-left corner
x: 0,
y: 1,
sizex: 0.2,
sizey: 0.2,
xref: 'paper',
yref: 'paper'
};
// show image and annotation
Plotly.relayout(el.id, {
images: [img]
});
})
}
")


#Mar 1-2: First community cases reported in AU (29 total cases) 
#Mar 21: AU reaches 1,000 cases
#Mar 19-22: AU govt closes borders to non-residents and non-citizens, and announced mandatory closures of non-essential businesses
```


### Sentiment + Drivers	


```{r}

g <- ggplot(iris, aes(x = Sepal.Length,
y = Petal.Length,
color = Species,
text = Species)) + geom_point()
p <- ggplotly(g, tooltip = "text")

p %>% htmlwidgets::onRender("
function(el, x) {
// when hovering over an element, do something
el.on('plotly_hover', function(d) {
// extract tooltip text
txt = d.points[0].data.text;
console.log(txt);
// image is stored locally
image_location = txt + '.jpeg';
// define image to be shown
var img = {
// location of image
source: image_location,
// top-left corner
x: 0,
y: 1,
sizex: 0.2,
sizey: 0.2,
xref: 'paper',
yref: 'paper'
};
// show image and annotation
Plotly.relayout(el.id, {
images: [img]
});
})
}
")


```


###	Sentiment Weekly Snapshot


### Trending Topics + Hashtags


### Desktop Search Phrases


